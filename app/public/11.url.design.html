<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>W&amp;M Server-side â€“ Course materials</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
    <link rel="stylesheet" href="main.css">
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section data-background="#b5533c">
            <h3>Web &amp; Mobile Server-side <small>[OGI03q]</small></h3>
            <h1>11. URL Design &amp; Routers</h1>
        </section>

        
        <!-- URL Design -->
        <section>
            <section>
                <h2>11.1<br>URL Design</h2>
            </section>

            <section data-background="assets/11/picard-facepalm.jpg">
                <h2>URLs in the olden days</h2>

                <ul>
                    <li>
                        In the beginning
                        <ul>
                            <li><code>http://example.org/index.php?action=zomg&amp;page=lol</code></li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        Then SEO and &ldquo;<em>nice urls</em>&rdquo; came along
                        <ul>
                            <li><code>http://example.org/zomg/lol</code></li>
                            <li><code>http://example.org/videos/latest/hamburgers</code></li>
                            <li><code>http://example.org/search/lolcats/pictures/yes/1/200</code></li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Why URL design?</h2>
                <ul>
                    <li>SEO (Search Engine Optimization)
                    </li>
                    <li style="margin-top: 1em">Usability
                        <ul>
                            <li>Users interact with URLs</li>
                            <li>A good URL is clear, concise and understandable</li>
                            <li>A good URL is <em>hackable</em></li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Constistency and Simplicity</h2>
                <ul>
                    <li>
                        Many URL design systems and conventions exists
                        <ul>
                            <li>They are optimized for different goals</li>
                            <li>There is a lot of debate on them</li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        The most important guidelines:
                        <ul>
                            <li>Be <strong>consistent</strong>: don't mix up systems</li>
                            <li>Keep it <strong>simple</strong>: don't make long and complex URLs</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section data-background="#fdfdfd">
                <h2 style="font-size:200%">Rule #1: Identification &amp; Hierarchy (1)</h2>
                <ul>
                    <li>
                        Basic naming conventions
                        <ul>
                            <li>Verbs are bad, nouns are good</li>
                            <li>You decide: use plurals <strong>everywhere</strong> or singulars <strong>everywhere</strong></li>
                            <li>Respect the Hierarchy</li>
                            <li>This does not apply to <em>&ldquo;normal pages&rdquo;</em></li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.7em">
                        Examples
                        <ul>
                            <li><ins><code>/products</code></ins></li>
                            <li><del><code>/product/1234</code></del> &rarr; <ins><code>/products/1234</code></ins></li>
                            <li><del><code>/photos/product/1234</code></del> &rarr; <ins><code>/products/1234/photos</code></ins></li>
                            <li><del><code>/photos/product/1234/5678</code></del> &rarr; <ins><code>/products/1234/photos/5678</code></ins></li>
                            <li><del><code>/pages/85/contact</code></del> &rarr; <ins><code>/contact</code></ins></li>
                        </ul>
                    </li>
                </ul>

            </section>

            <section data-background="#fdfdfd">
                <h2 style="font-size:200%">Rule #1: Identification &amp; Hierarchy (2)</h2>
                <ul>
                    <li>
                        Use concrete naming, yet don't be too specific
                        <ul>
                            <li><del><code>/things</code></del></li>
                            <li><del><code>/animals</code></del></li>
                            <li><code class="ok">/dogs</code></li>
                            <li><del><code>/beagles</code></del></li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Example</h2>

                <ul>
                    <li><code>/</code></li>
                    <li><code>/movies</code></li>
                    <li><code>/movies/<em>{id}</em></code></li>
                    <li><code>/movies/<em>{id}</em>/photos</code></li>
                    <li><code>/actors</code></li>
                    <li><code>/actors/<em>{id}</em></code></li>
                    <li><code>/actors/<em>{id}</em>/movies</code></li>
                    <li><code>/about</code></li>
                    <li><code>/contact</code></li>
                </ul>
            </section>

            <section data-background="#fdfdfd">
                <h2>Rule #2: Namespace prefix</h2>
                <ul style="font-size: 90%;">
                    <li>
                        Consider a namespace prefix only
                        <ul>
                            <li>in order to indicate a separate section on your website, which is not the <em>main</em> section (in the future)</li>
                            <li>or to avoid (future) URL conflicts</li>
                            <li>for account settings (don't start with the user)</li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.7em">
                        Examples
                        <ul>
                            <li><ins><code>/blog</code></ins></li>
                            <li><ins><code>/blog/posts/25</code></ins></li>
                            <li>On a web store: <del><code>/shop/products/1234</code></del> &rarr; <ins><code>/products/1234</code></ins></li>
                            <li>On a web store: <del><code>/categories/25/edit</code></del> &rarr; <ins><code>/admin/categories/25/edit</code></ins></li>
                            <li><del><code>/users/66/account/address</code></del> &rarr; <ins><code>/account/address</code></ins></li>
                        </ul>
                    </li>
                </ul>
                <footer>Note: a username can be a namespace to but you'll need a blacklist</footer>
            </section>

            <section>
                <h2>Rule #3: Forms with verbs (1)</h2>
                <ul>
                    <li>
                        Don't be confused
                        <ul>
                            <li>A lot of URL specifications are on <strong>RESTful Web APIs</strong>
                                <ul>
                                    <li>They avoid verbs in the URL</li>
                                    <li>They're using <strong>HTTP verbs/methods</strong> (<code>GET</code>, <code>PUT</code>, <code>DELETE</code>, &hellip;) to indicate the type of action</li>
                                </ul>
                            </li>
                            <li>The current rule is on <strong>action related to forms</strong>
                                <ul>
                                    <li>Showing the form (<code>GET</code>)</li>
                                    <li>Processing the action (<code>POST</code>)</li>
                                    <li>No other <strong>HTTP methods</strong> allowed </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>
            <section>
                <h2>Rule #3: Forms with verbs (2)</h2>
                <ul style="font-size: 85%;">
                    <li>
                        Define a set of verbs for Create, Update and Delete actions of forms
                        <ul>
                            <li>Attach the verb at the end of the URL
                            </li>
                            <li>
                                Respect your HTTP method: <code>GET</code> shows the form; <code>POST</code> processes the action
                            </li>
                            <li>
                                Stick to your choice: use the same verbs and system everywhere!
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        Examples
                        <ul style="font-size: 75%;">
                            <li><code>GET&nbsp;&nbsp;/admin/products</code></li>
                            <li><code>GET&nbsp;&nbsp;/admin/products/create</code></li>
                            <li><code>POST /admin/products/create</code></li>
                            <li><code>GET&nbsp;&nbsp;/admin/products/<em>{id}</em>/edit</code></li>
                            <li><code>POST /admin/products/<em>{id}</em>/edit</code></li>
                            <li><code>GET&nbsp;&nbsp;/admin/products/<em>{id}</em>/delete</code></li>
                            <li><code>POST /admin/products/<em>{id}</em>/delete</code></li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Note #1: Slug</h2>
                <ul>
                    <li>
                        Often the ID is replaced by a <a href="https://en.wikipedia.org/wiki/Clean_URL#Slug">slug</a>
                        <ul>
                            <li>
                                Slug = name of the resource in the form of human-readable keywords
                            </li>
                            <li>
                                Example: <code>/products/oneplus-10-onyx-blue</code></strong>
                            </li>
                            <li>
                                SEO: keep it short and use hyphens (<code>-</code>), no underscores (<code>_</code>)
                            </li>
                            <li>
                                Incorrect slug? Redirect!
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        Do we need IDs in URLs at all then?
                        <ul>
                            <li>
                                It depends &#8482;
                            </li>
                            <li>
                                No IDs is more SEO-friendly, but you need a performant <em>slug index</em> (column in your DB) and URLs become invalid when the resource title changes
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Note #2: duplicate URLs</h2>

                <ul>
                    <li style="margin-top: 1em">
                        Example
                        <ul style="font-size: 75%;">
                            <li><code>/products/1234</code></li>
                            <li><code>/categories/15/products/1234</code></li>
                            <li><code>/brands/9/products/1234</code></li>
                        </ul>
                    </li>
                    <li>
                        We call these <em>canonical</em> URLs
                        <ul>
                            <li>
                                It means that the pages are about the same resource but might not be exact copies (e.g. think of the breadcrumb)
                            </li>
                            <li>
                                You need to <a href="https://moz.com/blog/canonical-url-tag-the-most-important-advancement-in-seo-practices-since-sitemaps">hint</a> search engines about canonical URLs
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        Advise (not obligatory)
                        <ul>
                            <li>
                                Avoid canonical paths and keep URLs short and simple
                            </li>
                            <li>
                                Don't confuse URLs with breadcrumbs
                            </li>
                            <li>
                                Strip the URL hierarchy to its essence
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

        </section>


        <!-- Supporting Clean URLs -->
        <!--section>
            <section>
                <h2>11.2<br>Supporting Clean URLs</h2>
                
            </section>

            <section>
                <h2>Supporting Clean URLs</h2>
                <ol>
                    <li>
                        Make <strong>your webserver</strong> (Apache, nginx, &hellip;) redirect all requests to inexistent files/folders to <code>index.php</code>
                    </li>
                    <li style="margin-top: 1em;">
                        Build <code>index.php</code> in such a way so that it loads the requested content based upon the URL
                    </li>
                </ol>
            </section>

            <section>
                <h2>1. Howto: Apache</h2>
                <ul>
                    <li>
                        Possible using the <a href="https://httpd.apache.org/docs/2.4/mod/mod_rewrite.html"><code>mod_rewrite</code></a> Apache Module
                        <ul>
                            <li>Often not enabled by default</li>
                            <li>Install by <code>a2enmod rewrite</code>* and alike</li>
                        </ul>
                    </li>
                    <li>
                        Put a file named <code>.htaccess</code> in your root to <em>rewrite</em> requests to non-existing files to <code>index.php</code>
                        <pre class="bigger"><code class="hljs htaccess">RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . index.php [L]</code></pre>
                    </li>
                    <li>Better: include the rewrite rules in your <a href="https://stackoverflow.com/questions/10175513/mod-rewrite-in-vhosts-configuration">virtual hosts</a> config</li>
                </ul>
                <footer><small>* this is a line in the <code>Dockerfile</code> on which our <code>php-web</code> service is built</small></footer>
            </section-->

            <!--section>
                <h2>1. Howto: IIS</h2>
                <ul>
                    <li>
                        Possible using the <a href="http://www.iis.net/downloads/microsoft/url-rewrite">IIS Rewrite Module</a>
                    </li>
                    <li>
                        Put a file named <code>web.config</code> in your root to redirect requests to non-existing files to <code>index.php</code>
                        <pre class="bigger"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;
&lt;system.webServer&gt;
&lt;rewrite&gt;
    &lt;rules&gt;
        &lt;rule name=&quot;Main Rule&quot; stopProcessing=&quot;true&quot;&gt;
            &lt;match url=&quot;.*&quot; /&gt;
            &lt;conditions logicalGrouping=&quot;MatchAll&quot;&gt;
                &lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsFile&quot; negate=&quot;true&quot; /&gt;
                &lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsDirectory&quot; negate=&quot;true&quot; /&gt;
            &lt;/conditions&gt;
            &lt;action type=&quot;Rewrite&quot; url=&quot;index.php&quot; /&gt;
        &lt;/rule&gt;
    &lt;/rules&gt;
&lt;/rewrite&gt;
&lt;/system.webServer&gt;
&lt;/configuration&gt;</code></pre>
                    </li>
                </ul>
            </section-->

            <!--section>
                <h2>1. Howto: Built-in PHP server</h2>
                <ul>
                    <li>
                        <strong>All</strong> requests route to <code>index.php</code> by default
                        <ul>
                            <li>You'll need to add some extra PHP code to <code>index.php</code> to force non-404 requests route to the correct file
                            </li>
                        </ul>
                        <div><pre class="bigger"><code>&lt;?php

$filename = __DIR__ . preg_replace('#(\?.*)$#', '', $_SERVER['REQUEST_URI']);
if (php_sapi_name() === 'cli-server' &amp;&amp; is_file($filename)) {
	return false;
}

// rest of your code here</code></pre></div>
                    </li>
                </ul>
                <footer><em>Note: You can start a server by running <code>php -S localhost:8080</code> in your project www-root</em></footer>
            </section-->


            <!--section>
                <h2>2. Howto</h2>

                <ul>
                    <li>
                        Write something yourself.
                        <ul>
                            <li>Use the values in <code>$_SERVER['REQUEST_URI']</code> and <code>$_SERVER['REQUEST_METHOD']</code> to get started</li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        Install a <em>router</em> library that does this for you.
                        <ul>
                            <li><a href="https://symfony.com/doc/current/routing.html">Symfony Routing</a></li>
                            <li><a href="https://packagist.org/packages/nikic/fast-route">nikic/fast-route</a></li>
                            <li><a href="https://github.com/bramus/router">bramus/router</a></li>
                            <li>The router that ships with the framework you're using</li>
                        </ul>
                    </li>
                </ul>
            </section>


            <section>
                <h2>2. Example</h2>

                <pre class="bigger"><code class="hljs php">&lt;?php

require __DIR__ . '/vendor/autoload.php';

$router = new \Bramus\Router\Router();

$router-&gt;get('/', function() {
	echo 'index';
});

$router-&gt;get('/hello', function() {
	echo 'hello';
});

$router-&gt;get('/hello/(\w+)', function($name) {
	echo 'have a nice day ' . htmlentities($name);
});

$router->run();</code></pre>
                <div>
                    <code>webroot/</code>
                    <input type="text" class="routertest" value="hello">
                    <a href="" data-base-url="assets/11/examples/demo01/" target="_blank">&rarr;</a>
                </div>
            </section>

        </section-->

            <!-- Routing -->
            <!--section>
                <section>
                    <h2>11.3<br>The Router</h2>
                </section>

                <section>
                    <h2>bramus/router</h2>
                    <ul>
                        <li>
                            A lightweight and simple object oriented PHP Router
                            <ul>
                                <li>GitHub page with documentation: <a href="https://github.com/bramus/router">https://github.com/bramus/router</a></li>
                            </ul>
                        </li>
                        <li style="margin-top: 1em;">
                            Installation:
                            <ul>
                                <li>
                                    New project, not yet requiring it via Composer:
                                    <pre class="bigger"><code class="dontrun">composer require bramus/router ^1.6.1</code></pre>
                                </li>
                                <li>
                                    Existing project, already requiring it via Composer:
                                    <pre class="bigger"><code class="dontrun">composer install</code></pre>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Routing</h2>
                    <ul>
                        <li>
                            Definitions
                            <ul>
                                <li>A route is a combination of a <strong>pattern</strong> and an <strong>HTTP method</strong></li>
                                <li>A route is handled by a <strong>handling function</strong> which returns/does x/y</li>
                            </ul>
                        </li>
                        <li style="margin-top: 1em">
                            General example
                            <pre class="bigger"><code class="hljs php">require __DIR__ . '../vendor/autoload.php';

// Create Router instance
$router = new \Bramus\Router\Router();

// Define routes
$router-&gt;get('pattern1', function() { /* ... */ });
$router-&gt;get('pattern2', function() { /* ... */ });
$router-&gt;post('pattern3', function() { /* ... */ });

// Run it!
$router-&gt;run();</code></pre>
                        </li>
                    </ul>
                    <footer><small>HTTP request methods PUT, DELETE, &hellip; are supported too, but are only allowed in a Web API (~ HTTP standard)</small></footer>
                </section>

                <section>
                    <h2>Static Routes</h2>
                    <ul style="width: 100%;">
                        <li>Static routes are routes with a fixed pattern
                            <pre class="bigger"><code class="hljs php">$router-&gt;get('/', function() {
    echo 'Welcome';
});

$router-&gt;get('/about', function() {
    echo 'About Page Contents';
});

$router-&gt;get('/admin/products/create', function() {
    echo 'Showing a form to create a product';
});

$router-&gt;post('/admin/products/create', function() {
    echo 'Processing product creation form data:';
    print_r($_POST);
});
</code></pre>
                        </li>
                    </ul>
                    <footer>!!! Only the first route matched will be used. <br>If no route matches, <code>bramus/router</code> generates an <strong>empty</strong> 404 response. </footer>
                </section>

                <section>
                    <h2>Dynamic Routes</h2>
                    <ul>
                        <li>
                            Dynamic routes are routes with a dynamic pattern
                            <ul>
                                <li>The dynamic parts of the pattern will be converted to <strong>route variables</strong> which you pass into the handling function</li>
                            </ul>
                            <pre class="bigger"><code class="hljs php">$router-&gt;get('/hello/(\w+)', function($name) {
    echo 'Hello ' . htmlentities($name);
});

$router-&gt;get('/movies/(\d+)/photos/(\d+)', function($movieId, $photoId) {
    echo 'Movie #' . $movieId . ', photo #' . $photoId;
});                            </code></pre>
                            <div style="float:right;">
                                <code>webroot/</code>
                                <input type="text" class="routertest" value="movies/24/photos/4">
                                <a href="" data-base-url="assets/11/examples/demo02/" target="_blank">&rarr;</a>
                            </div>
                        </li>
                        <li> PCRE-based subpatterns between <code>()</code>
                            <ul style="font-size: 70%;">
                                <li><code>\d+</code> = One or more digits (0-9)</li>
                                <li><code>\w+</code> = One or more word characters (a-z 0-9 _)</li>
                                <li><code>[a-z0-9_-]+</code> = One or more word characters (a-z 0-9 _) and the dash (-)</li>
                                <li><code>.*</code> = Any character (including <code>/</code>), zero or more</li>
                                <li><code>[^/]+</code> = Any character but <code>/</code>, one or more</li>
                            </ul>

                        </li>
                    </ul>
                    <footer><small>Note: the path <code>/movies/abc/photos/def</code> will simply not match any of the routes, generating a 404 response.</small></footer>
                </section>

                <section>
                    <h2>Custom 404 and <em>Before</em> Middleware</h2>
                    <ul>
                        <li>
                            Override the custom 404 handler
                            <pre class="bigger"><code class="hljs php">$router-&gt;set404(function () {
    http_response_code(404);
    echo 'Looks like this page got lost in THE MATRIX.';
    // Better: load your 404 HTML template here
});</code></pre>
                        </li>
                        <li style="margin-top: 1em">
                            <em>Before</em> middleware: handler to be executed <strong>before</strong> the route handling is processed
                            <ul>
                                <li>Specify HTTP request method(s), route pattern and handler function</li>
                            </ul>
                            <pre class="bigger"><code class="hljs php">$router-&gt;before('GET|POST', '/.*', function () {
    header('X-Powered-By: bramus/router');
    // or your favorite checks here
});</code></pre>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Subrouting</h2>
                    <ul>
                        <li>
                            Mount a collection of routes onto a subroute pattern
                            <pre class="bigger"><code class="hljs php">$router-&gt;mount('/movies', function() use ($router) {

    // will result in '/movies/'
    $router-&gt;get('/', function() {
        echo 'movies overview';
    });

    // will result in '/movies/id'
    $router-&gt;get('/(\d+)', function($id) {
        echo 'movie id ' . htmlentities($id);
    });

});</code></pre>
                            <div style="float:right;">
                                <code>webroot/</code>
                                <input type="text" class="routertest" value="movies/">
                                <a href="" data-base-url="assets/11/examples/demo03/" target="_blank">&rarr;</a>
                            </div>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Demo: clean search URL</h2>

                            <pre class="bigger"><code class="hljs php">$router-&gt;get('/search', function() {
    echo '&lt;form method="post"&gt;&lt;input type="text" name="term"&gt;&lt;input type="submit"&gt;&lt;/form&gt;';
    // Better: load your W3C-valid HTML template here
});

$router-&gt;post('/search', function() {
    $term = (isset($_POST['term'])? $_POST['term'] : '');
    header('Location: search/' . urlencode($term));
    exit();
});

$router-&gt;get('/search/(\w+)', function($term) {
    echo 'Your search term: ' . $term . '&lt;br&gt;';
    // Look up and show matching items in the database
});</code></pre>
                            <div>
                                <code>webroot/</code>
                                <input type="text" class="routertest" value="search">
                                <a href="" data-base-url="assets/11/examples/demo04/" target="_blank">&rarr;</a>
                            </div>
                </section>

                <section>
                    <h2>Demo: same, with templating</h2>

                    <pre class="bigger"><code class="hljs php">require __DIR__ . '/../vendor/autoload.php';

$loader = new \Twig\Loader\FilesystemLoader(__DIR__ . '/templates');
$twig = new \Twig\Environment($loader);

$router = new \Bramus\Router\Router();

$router-&gt;get('/search', function() use ($twig) {
    echo $twig-&gt;render('search.twig' , ['term' =&gt; '', 'results' =&gt; []]);
});

$router-&gt;post('/search', function() {
    $term = (isset($_POST['term'])? $_POST['term'] : '');
    header('Location: search/' . urlencode($term));
    exit();
});

$router-&gt;get('/search/(\w+)', function($term) use ($twig) {
    // Look up and show matching items in the database
    echo $twig-&gt;render('search.twig' , ['term' =&gt; $term, 'results' =&gt; ['dummy1', 'dummy2']]);
});

$router-&gt;run();</code></pre>
                    <div>
                        <code>webroot/</code>
                        <input type="text" class="routertest" value="search">
                        <a href="" data-base-url="assets/11/examples/demo05/" target="_blank">&rarr;</a>
                    </div>
                </section>


                <section>
                    <h2>Linking your assets and URLs (1)</h2>
                    <ul style="width: 100%;">
                        <li>
                            Web assets
                            <ul>
                                <li>
                                    Images, stylesheets, &hellip; of your website
                                </li>
                                <li>
                                    Files consulted <strong>directly</strong> from the web server (not passing <code>index.php</code>)
                                </li>
                            </ul>
                        </li>
                        <li>
                            Suppose following code in <code>templates/search.twig</code>

                            <pre class="bigger"><code class="hljs twig">    &lt;link rel="stylesheet" href="layout.css"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form method="post" action="search"&gt;
    &lt;input type="text" class="textbox" placeholder="Search" name="term" value="{{ term }}" &gt;
    &lt;input title="Search" value="&#128269;" type="submit" class="button"&gt;
    {% if results %}
        &lt;p&gt;Resultaten:&lt;/p&gt;
        &lt;ul&gt;
            {% for result in results %}
                &lt;li&gt;{{ result }}&lt;/li&gt;
            {% endfor %}
        &lt;/ul&gt;
    {% endif %}
&lt;/form&gt;</code></pre>
                        </li>
                        <li>&rarr; Problem: relative paths attached to clean URLs e.g. <code>/search/search</code> </li>
                    </ul>
                    <div>
                        <code>webroot/</code>
                        <input type="text" class="routertest" value="search">
                        <a href="" data-base-url="assets/11/examples/demo05b/" target="_blank">&rarr;</a>
                    </div>
                </section>

                <section>
                    <h2>Linking your assets and URLs (2)</h2>
                    <ul>
                        <li>
                            Solution
                            <ul>
                                <li>Links starting by <code>/</code> are relative to the domain name</li>
                                <li>
                                    Generate any link to assets and local URLs as <code>'/my/base/path/' . $relativePath</code>

                                </li>
                                <li>Simple example
                                    <pre class="bigger"><code class="hljs twig">    {% set basePath = '/assets/11/examples/demo05/' %}
    &lt;link rel="stylesheet" href="{{ (basePath ~ 'layout.css') }}"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form method="post" action="{{ (basePath ~ 'search') }}"&gt;
    &lt;input type="text" class="textbox" placeholder="Search" name="term" value="{{ term }}" &gt;</code></pre>
                                </li>
                                <li>Better: define a custom Twig function <code>asset()</code> and define a <code>BASE_PATH</code> constant in your config files</li>

                            </ul>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Working with controllers</h2>

                    <ul>
                        <li>Problem:
                           <ul>
                               <li><code>index.php</code> contains all your application logic and keeps on growing</li>
                               <li>some routes (not all) need initialized resources (such as <code>$twig</code> and <code>$db</code>)
                                   and <code>index.php</code> gets cluttered</li>
                           </ul>

                        </li>
                        <li style="margin-top: 1em;">Solution:
                            <ul>
                                <li>Put your application logic in separate <code>*Controller</code> classes</li>
                                <li>Put the required initializations in the <code>*Controller</code> constructor</li>
                                <li>Associate any route with a <code>*Controller</code> method</li>
                                <li>Organize your controllers into logical units e.g. <code>ProductController</code>, <code>HomeController</code>, &hellip;</li>
                            </ul>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Controllers: howto (1)</h2>

                    <ul style="font-size: 80%; width: 100%;">
                        <li>Create a <code>*Controller</code> in the folder <code>src</code>
                            <pre class="bigger"><code class="hljs php">class SearchController
{</code></pre>
                        </li>
                        <li>
                            Tell composer to autoload our <code>src</code> folder in <code>composer.json</code>
                            <pre class="bigger"><code class="hjls json">   "autoload": {
        "classmap": ["src/"]
    }</code></pre>
                        </li>
                        <li>
                            Activate the autoload expression (or reindex any new classes in the classmap) by
                            <pre class="bigger"><code class="hjls bash">composer dump-autoload</code></pre>
                        </li>
                        <li>Refer to <code>*Controller</code> and its methods in <code>index.php</code>
                            <pre class="bigger"><code class="hljs php">require __DIR__ . '/../vendor/autoload.php';
$router = new \Bramus\Router\Router();

$router-&gt;get('/search', 'SearchController@show');

$router-&gt;post('/search', function() {
    $term = (isset($_POST['term'])? $_POST['term'] : '');
    header('Location: search/' . urlencode($term));
    exit();
});

$router-&gt;get('/search/(\w+)', 'SearchController@showResults');

$router-&gt;run();</code></pre>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Controllers: howto (2)</h2>

                    <ul style="font-size: 90%; width: 100%;">
                        <li >
                            Write the appropriate constructor and method(s) in <code>*Controller</code>
                            <pre class="bigger"><code class="hljs">class SearchController
{
    // protected \Doctrine\DBAL\Connection $db;
    protected \Twig\Environment $twig;

    public function __construct()
    {
        // initiate DB connection

        // bootstrap Twig
        $loader = new \Twig\Loader\FilesystemLoader(__DIR__ . '/../templates');
        $this-&gt;twig = new \Twig\Environment($loader);
    }

    public function show()
    {
        echo $this-&gt;twig-&gt;render('search.twig' , ['term' =&gt; '', 'results' =&gt; []]);
    }

    public function showResults($term)
    {
        echo $this-&gt;twig-&gt;render('search.twig' , ['term' =&gt; $term, 'results' =&gt; ['dummy1', 'dummy2']]);
    }
}</code></pre>
                        </li>
                    </ul>
                    <div>
                        <code>webroot/</code>
                        <input type="text" class="routertest" value="search">
                        <a href="" data-base-url="assets/11/examples/demo06/" target="_blank">&rarr;</a>
                    </div>
                </section>

            </section-->

        <!--section>

            <section>
                <h2>11.4<br>Takeaway:<br>Demo with Login</h2>
            </section>

            <section>
                <h2>Application</h2>
                <div style="text-align: center">
                    <figure>
                        <img src="assets/11/postits1.png" class="noborder" height="250" alt="" title="" />
                        &nbsp;
                        <img src="assets/11/postits2.png" class="noborder" height="250" alt="" title="" />
                    </figure>

                    <p style="font-size: 75%; margin-top: -1em;">let's have a  look at the demo <a href="assets/11/examples/post_its" target="_blank">&rarr;</a></p>
                </div>
            </section>

            <section>
                <h2>Overview: the router</h2>
                <pre class="bigger"><code class="hljs php">&lt;?php

require __DIR__ . '/vendor/autoload.php';
$router = new \Bramus\Router\Router();

$router-&gt;before('GET|POST', '/.*', function () {
    session_start();
});

$router-&gt;get('/', 'PostItController@showAllMessages');

$router-&gt;mount('/dashboard', function() use ($router) {

    $router-&gt;get('/', function() {
        header('Location: dashboard/messages');
        exit();
    });

    $router-&gt;get('/login', 'AuthController@showLogin');
    $router-&gt;post('/login', 'AuthController@login');
    $router-&gt;post('/logout', 'AuthController@logout');

    $router-&gt;before('GET|POST', '/messages.*', function () {
        if (! isset($_SESSION['user'])) {
            header('Location: /assets/11/examples/post_its/dashboard/login');
            exit();
        }
    });

    $router-&gt;get('/messages', 'PostItController@showPersonalMessages');
    $router-&gt;get('/messages/add', 'PostItController@showAdd');
    $router-&gt;post('/messages/add', 'PostItController@add');
    $router-&gt;get('/messages/(\d+)/delete', 'PostItController@showDelete');
    $router-&gt;post('/messages/(\d+)/delete', 'PostItController@delete');

});

$router-&gt;run();</code></pre>
                <p style="font-size: 75%; margin-top: -1em;">let's have a thourough look at the controllers &rarr;</p>
            </section>
            <section>
                <h2>Summary of the new elements</h2>
                <ul>
                    <li>Application of router <em>before</em> middleware</li>
                    <li style="margin-top: 1em;">Routes now fully comply with HTTP standard
                        <ul>
                            <li>
                                GET: showing (persisted) forms
                            </li>
                            <li>
                                POST: processing form data, logout
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">Form persistence through <strong>sessions</strong></li>
                    <li style="margin-top: 1em;">Security threat: <strong>unauthorized access</strong>
                        <ul>
                            <li>Avoid that an authenticated user can delete messages of other users</li>
                        </ul>
                    </li>
                </ul>
            </section>
        </section-->

        <!-- The END -->
        <section>
            <section>
                <h2>Questions?</h2>
                <footer>
                    <em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
                </footer>
            </section>
            <section>
                <h2>Sources</h2>
                <ul>
                    <li><a href="http://martinfowler.com/articles/richardsonMaturityModel.html">http://martinfowler.com/articles/richardsonMaturityModel.html</a></li>
                    <li><a href="https://www.creativebloq.com/design/design-perfect-url-1126509">https://www.creativebloq.com/design/design-perfect-url-1126509</a></li>

                </ul>
            </section>
        </section>




    </div>

</div>

<script src="dist/reveal.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/search/search.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>

    // Also available as an ES module, see:
    // https://revealjs.com/initialization/
    Reveal.initialize({
        controls: true,
        progress: true,
        center: true,
        hash: true,
        slideNumber: true,


        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
    });

</script>
<script src="toc.js"></script>
<script src="overlay.js"></script>
<script src="routertest.js"></script>
</body>
</html>
