<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>W&amp;M Server-side â€“ Course materials</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
    <link rel="stylesheet" href="main.css">
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section data-background="#b5533c">
            <h3>Web &amp; Mobile Server-side <small>[OGI03<span style="text-transform: lowercase;">q</span>]</small></h3>
            <h1>06. Forms</h1>
            <footer>Let's have a look at <em>old-skool</em> <br> server-side rendered forms</footer>
        </section>

        <!-- form basics -->
        <section>

            <section>
                <h2>06.1<br>&lt;form&gt; basics</h2>
            </section>

            <section data-background="#fdfdfd">
                <h2>Example form</h2>
                <div>
                    <figure>
                        <a href="assets/06/examples/form_01.php"><img src="assets/06/testform.jpg" alt="Our testform" title="Our testform" width="700" /></a>
                    </figure>
                    <p style="font-size: 75%">Let's take a look at <code>assets/06/examples/form_01.php</code> <a href="assets/06/examples/form_01.php">&rarr;</a></p>

                </div>
            </section>

            <section>
                <h2>A proper HTML Form (1)</h2>
                <ul>
                    <li>
                        If your form is built properly, it's easy to work with forms in PHP
                    </li>
                    <li>
                        Important HTML <code>&lt;form&gt;</code> attributes
                        <ul>
                            <li>
                                <code>method</code> &mdash; HTTP method to use; <code>get</code> or <code>post</code> (default: <code>get</code>)
                            </li>
                            <li>
                                <code>action</code> &mdash; Where to send the form-data to when submitted
                            </li>
                            <li>
                                <code>enctype</code> &mdash; How the form-data should be encoded when using <code>post</code>
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>A proper HTML Form (2)</h2>
                <ul>
                    <li>
                        Always give <code>&lt;input&gt;</code> and <code>&lt;textarea&gt;</code> elements a <code>name</code>
                        <ul>
                            <li>Radiobuttons: same <code>name</code> in same set</li>
                            <li>Checkboxes: same <code>name</code> with square brackets in same set</li>
                        </ul>
                    </li>
                    <li>
                        Always give	<code>&lt;select&gt;</code> elements a <code>name</code>
                        <ul>
                            <li>Specify a <code>value</code> for each <code>&lt;option&gt;</code> of the <code>&lt;select&gt;</code></li>
                        </ul>
                    </li>
                    <li>
                        <code>id</code> attributes not mandatory for proper functioning
                        <ul>
                            <li>Webbrowsers &amp; servers use the <code>name</code> attributes</li>
                            <li>Only to be added for JS purposes</li>
                            <li>Remember an <code>id</code> must be unique</li>
                        </ul>
                    </li>
                </ul>
            </section>

        </section>



        <!-- Handling Forms: Querystring, GET vs. POST -->
        <section>

            <section>
                <h2>06.2<br>Querystring</h2>
            </section>

            <section>
                <h2>Querystring?</h2>
                <ul>
                    <li>
                        Upon submitting your form, the browser will collect all (*) form-data in one text string named the <strong>querystring</strong>
                        <ul>
                            <li><em>(*) Not all really, more on that later</em></li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        Querystring format: <code>key=value&amp;key=value&amp;key=value</code>
                        <ul>
                            <li>The <code>key</code>s are the <code>name</code> attributes of the elements, the <code>value</code>s the entered/selected <code>value</code>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        The browser then makes a request to the URL defined in the form <code>action</code> attribute and pass that querystring to it
                    </li>
                </ul>
            </section>

            <section>
                <h2>GET vs POST (1)</h2>
                <ul>
                    <li>
                        With <code>GET</code> all values of the querystring are attached to the form its <code>target</code> URL
                        <ul>
                            <li>The entered values are visible in the URL of the browser</li>
                            <li>
                                In order to prevent conflicts the values are URL encoded before being attached
                                <ul>
                                    <li>Think <code>&amp;</code> and <code>=</code> that could break the format of the querystring</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        With <code>POST</code> the querystring is sent in the <em>request body</em>
                        <ul>
                            <li>
                                The entered values are not visible in the URL of the browser, only via sniffing
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section data-background="#fdfdfd">
                <h2>GET vs POST (2)</h2>
                <div style="text-align: center;">
                    <figure class="zoomable-15 fragment">
                        <img src="assets/06/request-get.jpg" alt="HTTP/1.1 request of a form sent via GET" width="500" />
                        <figcaption><small>HTTP/1.1 request of a form sent via GET</small></figcaption>
                    </figure>
                    <figure class="zoomable-15 fragment">
                        <img src="assets/06/request-post.jpg" alt="HTTP/1.1 request of a form sent via POST" width="500" />
                        <figcaption><small>HTTP/1.1 request of a form sent via POST</small></figcaption>
                    </figure>
                </div>
            </section>


            <section  data-background="#fdfdfd">
                <h2>URL Encoding</h2>
                <ul>
                    <li>
                        A few frequently used characters
                        <table style="font-size: 50%;">
                            <thead>
                            <tr>
                                <th>Character</th>
                                <th>URL Encoded</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>$</td>
                                <td>%24</td>
                            </tr>
                            <tr>
                                <td>&amp;</td>
                                <td>%26</td>
                            </tr>
                            <tr>
                                <td>&lt;</td>
                                <td>%3C</td>
                            </tr>
                            <tr>
                                <td>&gt;</td>
                                <td>%3E</td>
                            </tr>
                            <tr>
                                <td>?</td>
                                <td>%3F</td>
                            </tr>
                            <tr>
                                <td>;</td>
                                <td>%3B</td>
                            </tr>
                            <tr>
                                <td>#</td>
                                <td>%23</td>
                            </tr>
                            <tr>
                                <td>/</td>
                                <td>%3A</td>
                            </tr>
                            <tr>
                                <td>=</td>
                                <td>%3D</td>
                            </tr>
                            <tr>
                                <td>,</td>
                                <td>%2C</td>
                            </tr>
                            <tr>
                                <td>&quot;</td>
                                <td>%22</td>
                            </tr>
                            <tr>
                                <td>'</td>
                                <td>%27</td>
                            </tr>
                            <tr>
                                <td>+</td>
                                <td>%2B</td>
                            </tr>
                            <tr>
                                <td>%</td>
                                <td>%25</td>
                            </tr>
                            </tbody>
                        </table>
                    </li>
                </ul>
            </section>

            <section>
                <h2>After sending</h2>
                <ul>
                    <li>
                        After sending, PHP will decode the querystring and fill some associative arrays with the sent-in values for the receiving PHP script
                        <ul>
                            <li><code>$_GET</code> &mdash; All values sent via <code>GET</code></li>
                            <li><code>$_POST</code> &mdash; All values sent via <code>POST</code></li>
                            <li>
                                <code>$_REQUEST</code> &mdash; All values sent via <code>GET</code> and <code>POST</code>
                                <ul>
                                    <li>Deprecated, don't ever use this!</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
                <footer>These arrays are also known as <a href="http://php.net/manual/en/language.variables.superglobals.php">Superglobals</a></footer>
            </section>

            <section data-background="#fdfdfd">
                <h2>$_GET / $_POST Example</h2>
                <div>
                    <figure>
                        <a href="assets/06/examples/form_01.php"><img src="assets/06/testform.jpg" alt="Our testform" title="Our testform" width="700" /></a>
                    </figure>
                    <p style="font-size: 75%">Let's take a look at <code>assets/06/examples/form_01.php</code> and <code>assets/06/examples/form_process.php</code> <a href="assets/06/examples/form_01.php">&rarr;</a></p>

                </div>
            </section>

            <section>
                <h2>Querystring revisited</h2>
                <ul>
                    <li>
                        Upon submitting, all form fields are included in the <em>querystring</em>, except:
                        <ul>
                            <li>Controls without a name attribute (<a href="assets/06/examples/form_02.php">demo</a>)</li>
                            <li>Unchecked radiobuttons (<a href="assets/06/examples/form_03.php">demo</a>)</li>
                            <li>Disabled controls (<a href="assets/06/examples/form_04.php">demo</a>)</li>
                            <li>Buttons that were not clicked (<a href="assets/06/examples/form_04.php">demo</a>)</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section data-background="#fdfdfd">
                <h2>Summarized example: our testform</h2>
                <div>
                    <figure>
                        <a href="assets/06/examples/form_05.php"><img src="assets/06/testform.jpg" alt="Our testform" title="Our testform" width="700" /></a>
                    </figure>
                </div>
            </section>

            <section>
                <h2>Sidenote: combining GET and POST</h2>
                <ul>
                    <li>
                        Possible if you already have parameters added onto the <code>target</code> URL
                    </li>
                </ul>
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/get_and_post.php">&lt;form action=&quot;form_process.php?foo=getfoo&amp;amp;bar=getbar&quot; method=&quot;post&quot;&gt;
	&lt;fieldset&gt;
		&lt;h2&gt;Get and Post&lt;/h2&gt;
		&lt;dl class=&quot;clearfix&quot;&gt;
			&lt;dt&gt;&lt;label for=&quot;foo&quot;&gt;Foo?&lt;/label&gt;&lt;/dt&gt;
			&lt;dd class=&quot;text&quot;&gt;
				&lt;input type=&quot;text&quot; id=&quot;foo&quot; name=&quot;foo&quot; value=&quot;&quot; /&gt;
			&lt;/dd&gt;

			&lt;dt&gt;&lt;label for=&quot;baz&quot;&gt;Baz?&lt;/label&gt;&lt;/dt&gt;
			&lt;dd class=&quot;text&quot;&gt;
				&lt;input type=&quot;text&quot; id=&quot;baz&quot; name=&quot;baz&quot; value=&quot;&quot; /&gt;
			&lt;/dd&gt;

			&lt;dt class=&quot;full clearfix&quot; id=&quot;lastrow&quot;&gt;
				&lt;input type=&quot;submit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;
			&lt;/dt&gt;
		&lt;/dl&gt;
	&lt;/fieldset&gt;
&lt;/form&gt;</code></pre></div>

            </section>

            <section>
                <h2>When to use GET or POST (1)</h2>
                <ul>
                    <li>
                        Use <code>GET</code> for read actions
                        <ul style="font-size: 80%;">
                            <li>show a news article</li>
                            <li>show a form</li>
                            <li>get search results</li>
                        </ul>
                    </li>
                    <li>
                        Use <code>POST</code> for manipulative* and sensitive actions
                        <ul style="font-size: 80%;">
                            <li>add a blog post</li>
                            <li>delete a user</li>
                            <li>register for an event</li>
                            <li>log in</li>
                        </ul>
                    </li>
                    <li>
                        Use <code>POST</code> when sending files
                    </li>
                    <li>
                        Use <code>POST</code> for lengthy data <em>(Max length URLs: 2048 chars)</em>
                    </li>
                </ul>
                <footer><small>* actions that change data or that change the user's state</small></footer>
            </section>

            <section>
                <h2>When to use GET or POST (2)</h2>
                <ul>
                    <li>
                        Examples of how it's not done:
                        <ul>
                            <li>
                                Consider these links
                                <ul>
                                    <li><code>index.php?module=blog&amp;action=delete&amp;id=1</code></li>
                                    <li><code>login.php?username=bramus&amp;password=Azerty123</code></li>
                                </ul>
                            </li>
                            <li>
                                Why not <code>GET</code>?
                                <ul>
                                    <li><code>GET</code> can be bookmarked</li>
                                    <li><code>GET</code> can be distributed/embedded (iframe)</li>
                                    <li><code>GET</code> can be cached by webspiders</li>
                                    <li><code>GET</code> remains visible in the browser history</li>
                                    <li><code>GET</code> link can be prefetched by the browser</li>
                                </ul>
                            </li>
                            <li>
                                &rarr; Use <code>POST</code> instead!
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

        </section>


        <!-- Processing forms -->
        <section>

            <section>
                <h2>06.3<br>PHP Form Processing</h2>
            </section>

            <section>
                <h2>Sending forms</h2>
                <ul>
                    <li>
                        The <code>action</code> attribute defines where to send a form to
                    </li>
                    <li style="margin-top: 1em;">
                        In PHP we'll opt to send a form to itself
                    </li>
                    <li style="margin-top: 1em;">
                        Instead of typing the name of the file in manually, you can let PHP automatically output the URL of the page itself into the <code>action</code> attribute's value
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/persistency_01.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	...
&lt;/form&gt;</code></pre></div>
                    </li>
                </ul>
                <footer><small>&rarr; This way we can put a file anywhere on the server, it will always submit to itself</small></footer>
            </section>

            <section>
                <h2>Default code structure</h2>
                <ul>
                    <li>
                        A PHP page typically consists of two parts:
                        <ol>
                            <li>PHP Logic at the top</li>
                            <li>HTML <em>(with a little PHP in between)</em> at the bottom</li>
                        </ol>
                    </li>
                    <li style="margin-top: 1em">
                        In the first part we'll:
                        <ul>
                            <li>
                                Get all values from <code>$_GET</code> or <code>$_POST</code>
                            </li>
                            <li>
                                Process the form (if it was submitted)
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        In the second part we'll:
                        <ul>
                            <li>
                                Put our HTML
                            </li>
                            <li>
                                Use PHP to persist the values entered (if it was submitted)
                            </li>
                        </ul>
                    </li>
                </ul>
                <footer><small>The line separating the two can be recognized by <code>?&gt;&lt;!DOCTYPE html&gt;</code></small></footer>
            </section>
        </section>



        <!-- Persistence -->
        <section>

            <section>
                <h2>06.4<br>Persisting form values</h2>
            </section>

            <section>
                <h2>Persistence</h2>

                <ul>
                    <li>
                        = After having submitted the form to itself, make it show again the values you entered.
                    </li>
                    <li style="margin-top: 1em;">
                        Different types of inputs (text, checkbox, dropdown) require different persistency methods
                    </li>
                </ul>
            </section>

            <section>
                <h2>Persisting text inputs</h2>
                <ul style="width: 100%;">
                    <li>
                        <code>&lt;input type=&quot;text|password&quot;&gt;</code> and <code>&lt;textarea&gt;</code>
                        <ul>
                            <li>Just output the sent-in value</li>
                        </ul>
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/persistency_02.php" data-overlay-height="600" style="height: 350px; overflow-y: scroll;">&lt;?php

    // Get variable values from $_GET
    // Caution: before form submission, $_GET is completely empty!
    $name = isset($_GET['name']) ? (string) $_GET['name'] : '';
    $pass = isset($_GET['pass']) ? (string) $_GET['pass'] : '';
    $remark = isset($_GET['remark']) ? (string) $_GET['remark'] : '';

?&gt;&lt;DOCTYPE html&gt;

...

&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;

	&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&lt;?php echo $name; ?&gt;&quot; /&gt;

	&lt;input type=&quot;password&quot; id=&quot;pass&quot; name=&quot;pass&quot; value=&quot;&lt;?php echo $pass; ?&gt;&quot; /&gt;

	&lt;textarea name=&quot;remark&quot; id=&quot;remark&quot; rows=&quot;5&quot;
		cols=&quot;40&quot;&gt;&lt;?php echo $remark; ?&gt;&lt;/textarea&gt;

&lt;/form&gt;</code></pre></div>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Persisting dropdowns</h2>
                <ul>
                    <li>
                        <code>&lt;select&gt;</code>
                        <ul>
                            <li>For each <code>&lt;option&gt;</code>, check if the value matches the sent-in value</em></li>
                            <li>If so: set the <code>selected=&quot;selected&quot;</code> attribute</li>
                        </ul>
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/persistency_03.php" data-overlay-height="600" style="width: 50em;">&lt;?php

    // Get variable values from $_GET
    // Caution: before form submission, $_GET is completely empty!
    $cont = isset($_GET['cont']) ? (int) $_GET['cont'] : 0;

?&gt;&lt;DOCTYPE html&gt;

...

&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	&lt;select name=&quot;cont&quot; id=&quot;cont&quot;&gt;
		&lt;option value=&quot;0&quot;&lt;?php if ($cont == 0) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Please select...&lt;/option&gt;
		&lt;option value=&quot;1&quot;&lt;?php if ($cont == 1) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Africa&lt;/option&gt;
		&lt;option value=&quot;2&quot;&lt;?php if ($cont == 2) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;America&lt;/option&gt;
		&lt;option value=&quot;3&quot;&lt;?php if ($cont == 3) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Antarctica&lt;/option&gt;
		&lt;option value=&quot;4&quot;&lt;?php if ($cont == 4) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Asia&lt;/option&gt;
		&lt;option value=&quot;5&quot;&lt;?php if ($cont == 5) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Europe&lt;/option&gt;
		&lt;option value=&quot;6&quot;&lt;?php if ($cont == 6) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Oceania&lt;/option&gt;
	&lt;/select&gt;
&lt;/form&gt;</code></pre></div>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Persisting radiobtns &amp; checkboxes</h2>
                <ul>
                    <li>
                        <code>&lt;input type=&quot;radio|checkbox&quot;&gt;</code>
                        <ul>
                            <li>For each radiobutton, check if the value matches the sent-in value</li>
                            <li>If so: set the <code>checked=&quot;checked&quot;</code> attribute</li>
                        </ul>
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/persistency_04.php" data-overlay-height="600" style="height: 350px; overflow-y: scroll;">&lt;?php

	// Get variable values from $_GET
    $gender = isset($_GET['gender']) ? (string) $_GET['gender'] : '';
    $meals = isset($_GET['meals']) ? (array) $_GET['meals'] : array();

?&gt;&lt;DOCTYPE html&gt;

...

&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;

	&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;male&quot;&lt;?php if ($gender
		 == 'male') { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;
	&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;female&quot;&lt;?php if ($gender
		 == 'female') { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;

	&lt;input type=&quot;checkbox&quot; name=&quot;meals[]&quot; value=&quot;breakfast&quot;&lt;?php if (in_array(
		'breakfast', $meals)) { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;
	&lt;input type=&quot;checkbox&quot; name=&quot;meals[]&quot; value=&quot;lunch&quot;&lt;?php if (in_array(
		'lunch', $meals)) { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;
	&lt;input type=&quot;checkbox&quot; name=&quot;meals[]&quot; value=&quot;dinner&quot;&lt;?php if (in_array(
		'dinner', $meals)) { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;

&lt;/form&gt;</code></pre></div>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Caution: htmlentities/XSS (1)</h2>
                <ul>
                    <li>
                        If we enter some HTML-looking text, we break the form
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/persistency_06.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	(same HTML code as before)
&lt;/form&gt;</code></pre></div>
                        <ul>
                            <li>
                                When entering <code>hello &quot; /&gt; test</code> we get this HTML
                                <pre class="bigger"><code>&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;hello&quot; /&gt; test&quot; /&gt;</code></pre>
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        Fix: convert special characters with <code>htmlentities()</code> to their HTML safe / encoded version <strong>when outputting on screen</strong>
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/persistency_07.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot;
	value=&quot;&lt;?php echo htmlentities($name); ?&gt;&quot; /&gt;
&lt;/form&gt;</code></pre></div>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Caution: htmlentities/XSS (2)</h2>
                <ul>
                    <li>
                        You must <strong>always</strong> use <code>htmlentities()</code> if you output/show user input in an HTML page
                        <ul>
                            <li>If you don't, users can inject custom HTML into your site</li>
                            <li>Not a big security threat if it's <code>&lt;b&gt;&lt;/b&gt;</code></li>
                            <li>But what if we inject a custom javascript file via <code>&lt;script src=&quot;http://mysite.com/pwnd.js&quot;&gt;&lt;/script&gt;</code>?</li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        This kind of attack is known as <strong>cross-site scripting</strong> or <strong>XSS</strong>
                        <ul>
                            <li>XSS is <a href="http://blogs.msdn.com/b/ie/archive/2012/09/10/xss-trends-and-internet-explorer.aspx">the most common vulnerability of websites</a>!</li>
                            <li>Example: <a href="http://blog.twitter.com/2010/09/all-about-onmouseover-incident.html">Twitter onMouseOver incident</a></li>
                            <!-- li>Example: <a href="http://praetorianprefect.com/archives/2010/06/persistent-xss-on-twitter-com/">Persistent XSS on Twitter</a></li -->
                        </ul>
                    </li>
                </ul>
                <footer><em style="color: #F55;">!! You prevent XSS in the lab !!</em></footer>
            </section>



            <section>
                <h2>Summary</h2>

                <ul>
                    <li>
                        Put a block of code at the top where you fetch all vars and then later on work with those vars
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/persistency_11.php" data-overlay-height="600" style="width: 50em;">&lt;?php

	$name = isset($_GET['name']) ? (string) $_GET['name'] : '';
	$pass = isset($_GET['pass']) ? (string) $_GET['pass'] : '';
	$gender = isset($_GET['gender']) ? (string) $_GET['gender'] : '';
	$cont = isset($_GET['cont']) ? (int) $_GET['cont'] : 0;
	$meals = isset($_GET['meals']) ? (array) $_GET['meals'] : array();
	$remark = isset($_GET['remark']) ? (string) $_GET['remark'] : '';

?&gt;&lt;!doctype html&gt;
...
&lt;dd class=&quot;text&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&lt;?php echo htmlentities($name); ?&gt;&quot; class=&quot;input-text&quot; /&gt;&lt;/dd&gt;
...</code></pre></div>
                    </li>
                    <li>
                        Always work with the raw variables in your scripts.<br />Only use <code>htmlentities()</code> when outputting it on screen
                    </li>
                </ul>
            </section>

        </section>


        <!-- Formchecking -->
        <section>

            <section>
                <h2>06.5<br>Formchecking</h2>
            </section>

            <section>
                <h2>Formchecking</h2>
                <ul>
                    <li>= Check all values of a sent form for validity</li>
                    <li style="margin-top: 1em;">
                        If all checks out
                        <ol>
                            <li>Perform an action <em>(e.g. send an e-mail, insert a record into a database, etc.)</em></li>
                            <li>Redirect to a thanks/OK page using <code>header('Location: ...');</code></li>
                        </ol>
                    </li>
                    <li style="margin-top: 1em;">
                        If it doesn't check out
                        <ol>
                            <li>Build a list of error messages</li>
                            <li>Continue with the script and show the form, including its error messages</li>
                        </ol>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Why formchecking?</h2>
                <ul>
                    <li>
                        Don't ever trust user input
                        <ul>
                            <li>Data might be crafted in a way to harm your server (XSS!) or your data(base)</li>
                            <li>Data might be in the wrong format (e.g. dates)</li>
                        </ul>
                    </li>
                    <li>
                        Even if a user means no harm, he might just have forgotten to complete a field
                    </li>
                    <li>
                        Therefore you <strong>must</strong> verify all incoming data
                        <ul>
                            <li>If any data is missing or malformed, inform the user with a proper message</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Parameter Tampering</h2>
                    <p style="color: red;">Note that a user can easily edit the DOM (<code>POST</code>) or URL (<code>GET</code>)</p>
                    <p style="color: lightskyblue;">JavaScript cannot prevent malicious user input</p>
                    <p style="color: greenyellow;">Form control restrictions such as <code>&lt;input type="number" max="3"&gt;</code> cannot prevent malicious user input</p>
                    <p style="color: red;">Note that a user can <a href="https://linuxize.com/post/curl-post-request/">craft</a> any sort of HTTP request using <code>curl</code></p>
            </section>


            <section>
                <h2>How to know if a form was sent? (1)</h2>
                <ul>
                    <li>
                        Remember: clicked buttons are also sent
                    </li>
                </ul>
                        <div><pre class="bigger"><code class="hljs php">&lt;?php

    // form was sent!
    if (isset($_POST['btnSubmit'])) {

        // @TODO: put formchecking logic here

    }

    ...</code></pre></div>


            </section>

            <section>
                <h2>How to know if a form was sent? (2)</h2>
                <ul>
                    <li>
                        Pro-tip: Use a hidden field instead of trusting the button being clicked
                    </li>


                </ul>
                        <div><pre class="bigger"><code class="hljs php">&lt;?php

    $moduleAction = isset($_POST['moduleAction']) ? $_POST['moduleAction'] : '';

    // Form was sent!
    if ($moduleAction == 'processName') {
        // @TODO: put formchecking logic here
    }

?&gt;&lt;!DOCTYPE html&gt;

	...

	&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot;&gt;

		...

		&lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processName&quot; /&gt;
		&lt;input type=&quot;submit&quot; id=&quot;btnSubmit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;

		...

	&lt;/form&gt;</code></pre></div>


            </section>

            <section>
                <h2>How to know if a form was sent? (3)</h2>
                <ul>
                    <li style="margin-top: 1em">
                        Bonus: it affords to have one page process multiple forms
                    </li>
                </ul>
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/formchecking_multipleforms.php" data-overlay-height="600" style="height: 350px; overflow-y: scroll;">&lt;?php

    // initial values
    $moduleAction = isset($_POST['moduleAction']) ? $_POST['moduleAction'] : '';

    // form #1 was sent
    if ($moduleAction == 'processName') {
        // @TODO: put formchecking (form #1 only) logic here
    }

    // form #2 was sent
    if ($moduleAction == 'processAge')) {
        // @TODO: put formchecking (form #2 only) logic here
    }

    // ...

?&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
...
&lt;body&gt;

	&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot;&gt;

		...

		&lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processName&quot; /&gt;
		&lt;input type=&quot;submit&quot; id=&quot;btnSubmit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;

		...

	&lt;/form&gt;

	&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot;&gt;

		...

		&lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processAge&quot; /&gt;
		&lt;input type=&quot;submit&quot; id=&quot;btnSubmit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;

		...

	&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>

            </section>

            <section>
                <h2>Formchecking Example (Simplified)</h2>
                <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/formchecking.php" data-overlay-height="600">&lt;?php

    // initial values
    $moduleAction = isset($_POST['moduleAction']) ? $_POST['moduleAction'] : '';
    $name = isset($_POST['name']) ? (string) $_POST['name'] : '';
    $msgName = '*';

    // form is sent
    if ($moduleAction == 'processName') {

        $allOk = true;

        // name not set, or empty
        if (trim($name) === '') {
            $msgName = 'Please enter your name';
            $allOk = false;
        }

        // end of form check.
        // If $allOk still is true, then the form was sent in correctly
        if ($allOk) {
            header('Location: formchecking_thanks.php?name=' .urlencode($name));
            exit();
        }

    }
	...</code></pre></div>
            </section>

            <section>
                <h2>Sidenote: urlencode</h2>
                <ul>
                    <li>
                        When redirecting with a parameter in the URL, you must always <code>urlencode()</code> it manually
                        <ul>
                            <li>Again, never trust user submitted data</li>
                            <li>The browser does this for you when submitting a form, but as we're doing it on the server now &hellip;
                        </ul>
                    </li>
                    <li>
                        Not encoded
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/redirect_01.php" data-overlay-height="600">$gun = 'smith&amp;wesson';
header('Location: redirect_process.php?gun=' . $gun);
exit(0); // do not forget to exit after redirect</code></pre></div>
                    </li>
                    <li>
                        Encoded
                        <div><pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/redirect_02.php" data-overlay-height="600">$gun = 'smith&amp;wesson';
header('Location: redirect_process.php?gun=' . urlencode($gun));
exit(0); // do not forget to exit after redirect</code></pre></div>
                    </li>
                </ul>
            </section>

            <section data-background="#fdfdfd">
                <h2>Client-server traffic</h2>
                <p><img src="assets/06/http_sequence_diagram.png" alt="" title="" height="400" style="border: 0px;" class="zoomable-15"/></p>
            </section>
        </section>


        <!-- File Uploads -->
        <section>

            <section>
                <h2>06.6<br>File Uploads</h2>
            </section>

            <section>
                <h2>post_max_size and upload_max_filesize</h2>
                <ul>
                    <li>
                        PHP can restrict the filesize of a POST request and uploads
                    </li>
                    <li>
                        In <code>php.ini</code> the <code>post_max_size</code> and <code>upload_max_filesize</code> settings limit this
                        <ul>
                            <li>
                                <code>post_max_size</code> limits the size of a POST request, including files
                            </li>
                            <li>
                                <code>upload_max_filesize</code> limits the size of an uploaded file
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>File Uploads</h2>
                <ul>
                    <li>Preparation
                        <ul>
                            <li>Add the <code>enctype=&quot;multipart/form-data&quot;</code> attribute to the form </li>
                            <li>Set the form <code>method</code> to <code>post</code></li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        Handling file uploads
                        <ul>
                            <li>PHP will fill the <code>$_FILES</code> superglobal with info about each file sent</li>
                            <li>File uploads are stored in a temp folder on the server, you'll have to move them manually</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Demo</h2>
                <pre class="bigger"><code class="hljs php" data-overlay-example="assets/06/examples/files_01.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;

    &lt;fieldset&gt;

        &lt;h2&gt;Testform&lt;/h2&gt;

        &lt;dl class=&quot;clearfix&quot;&gt;

            &lt;dt&gt;&lt;label for=&quot;image&quot;&gt;Image&lt;/label&gt;&lt;/dt&gt;
            &lt;dd&gt;&lt;input type=&quot;file&quot; id=&quot;image&quot; name=&quot;image&quot; value=&quot;&quot; /&gt;&lt;/dd&gt;

            &lt;dt&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processUpload&quot; /&gt;
                &lt;input type=&quot;submit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;
            &lt;/dt&gt;

        &lt;/dl&gt;

    &lt;/fieldset&gt;

&lt;/form&gt;</code></pre>
                <footer >Note: it is not possible to persist files in the strict sense.</footer>
            </section>

            <section>
                <h2>Under the hood</h2>
                <ul>
                    <li>
                        The browser will send the file as an entity
                        <ul>
                            <li>Entities are sent in the <strong>request body</strong></li>
                            <li>Entities are separated by a <strong>boundary</strong>, randomly generated by the browser</li>
                            <li>Each entity has its own headers identifying the entity</li>
                        </ul>
                    </li>
                </ul>

                    <figure class="zoomable-20">
                        <img src="assets/06/files.jpg" alt="HTTP/1.1 request of a file sent via POST" title="HTTP/1.1 request of a file sent via POST" width="350" />
                        <figcaption><small>HTTP/1.1 request of a file sent via POST</small></figcaption>
                    </figure>

                <footer ><small>Note: the boundary and entity headers are part of the multipart/form-data [RFC 2388] standard</small></footer>
            </section>

            <section>
                <h2>Handling file uploads (1)</h2>
                <ul>
                    <li>
                        File size (and upload time) are limited by <a href="http://php.net/manual/en/features.file-upload.common-pitfalls.php">several settings</a> in <code>php.ini</code>
                    </li>
                    <li style="margin-top: 1em;">
                        Files are uploaded to a temp location. You'll need to move them manually using <code>move_uploaded_file()</code>
                    </li>
                    <li>
                        PHP will populate a <em>superglobal</em> named <code>$_FILES</code> containing that temp location per file.
                    </li>
                </ul>
                <footer >Don't forget: make sure your webserver has the proper permissions!</footer>
            </section>

            <section>
                <h2>Handling file uploads (2)</h2>
                <ul style="width: 100%;">
                    <li>
                        Example
                    </li>
                </ul>
                        <pre ><code class="language-php" data-overlay-example="assets/06/examples/upload.php">&lt;?php
if (isset($_FILES['avatar']) &amp;&amp; ($_FILES['avatar']['error'] === UPLOAD_ERR_OK)) {

    echo '&lt;p&gt;Uploaded file: ' . $_FILES['avatar']['name'] . '&lt;/p&gt;';
    echo '&lt;p&gt;Temp location: ' . $_FILES['avatar']['tmp_name'] . '&lt;/p&gt;';
    echo '&lt;p&gt;Size: ' . $_FILES['avatar']['size'] . '&lt;/p&gt;';

    if (in_array((new SplFileInfo($_FILES['avatar']['name']))-&gt;getExtension(), ['jpeg', 'jpg', 'png', 'gif'])) {

        $moved = @move_uploaded_file($_FILES['avatar']['tmp_name'], __DIR__ . '/' . $_FILES['avatar']['name']);
        if ($moved) {
            echo '&lt;p&gt;&lt;img src="' . $_FILES['avatar']['name'] . '" alt=&quot;&quot; /&gt;&lt;p&gt;';
        } else {
            echo('&lt;p&gt;Error while saving file in the uploads folder&lt;/p&gt;')
        }
    } else {
        echo('&lt;p&gt;Invalid extension. Only .jpeg, .jpg, .png or .gif allowed&lt;/p&gt;');
    }
}

?&gt;
&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF'];?&gt;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; &gt;
	&lt;input type=&quot;file&quot; name=&quot;avatar&quot; id=&quot;avatar&quot; /&gt;&lt;input type=&quot;submit&quot; /&gt;
&lt;/form&gt;</code></pre>

                <footer  style="line-height: 1.2em">Full reference of <a href="http://php.net/manual/en/features.file-upload.errors.php">upload error codes</a>.
                    <br/>
                    Caution: this is just a demo.
                    <br>
                    In a properly structured script, you don't <code>echo</code> in the PHP Logic at the top.
                </footer>
            </section>

            <section>
                <h2>Security / Best Practices</h2>

                <ul>
                    <li>
                        Provide a separate, dedicated folder to store all uploads
                        <ul>
                            <li>e.g. <code>files/</code></li>
                            <li>Use subfolders where appropriate, e.g. <code>files/photoalbums/1</code> and <code>files/photoalbums/2</code></li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.5em;">
                        Rename files when moving them to prevent name conflicts
                        <ul>
                            <li> e.g. give photos in photoalbums a sequential name such as <code>1.jpg</code>, <code>2.jpg</code>, etc.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.5em;">
                        Always limit the allowed file extensions
                        <ul>
                            <li>You don't want one to upload a <code>.php</code> file, right?</li>
                        </ul>
                    </li>
                </ul>
            </section>

        </section>

        <section>
            <section>
                <h2>06.7<br>Present-day forms?</h2>
            </section>

            <section>
                <h2>Present-day forms</h2>
                <ul>
                    <li>
                        Nowadays, most often
                        <ul style="font-size: 85%;">
                            <li>
                                forms are validated client-side (Javascript) before any data is submitted to the server
                            </li>
                            <li>
                                when you press the button of a form, the browser does not submit the form cf. the HTML specs
                            </li>
                            <li>
                                when you press the button of a form, a Javascript listener is activated in order to validate and submit the data in background to some web service
                            </li>
                            <li>
                                the response of the webservice is handled by Javascript changing the DOM
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.5em;">
                        Often, this so-called webservice is part of a <em>REST Web API</em>
                        <br>&rarr; we'll see <strong>Web APIs</strong> later on
                    </li>
                    <li style="margin-top: 0.5em;">
                        Want some minimal example?
                        <br>&rarr; let's have a look at <a href="assets/06/examples/form_with_javascript.html" target="_blank">assets/06/examples/form_with_javascript.html</a>
                    </li>
                </ul>
            </section>
            <section>
                <h2>Similarities</h2>
                <ul>
                    <li style="margin-top: 0.5em;">
                        It's a good idea to keep the same HTML-structure (<code>&lt;form&gt;</code>)
                    </li>
                    <li style="margin-top: 0.5em;">
                        You need to read the parameters from the querystring* sent to the server
                    </li>
                    <li style="margin-top: 0.5em;">
                        <strong>You still need to validate the form data on the server! Beware of parameter tampering!</strong>
                    </li>
                </ul>

                <footer><br><small>* in Web APIs, you'll receive the request body parameters in JSON </small></footer>
            </section>
        </section>





        <!-- The END -->
        <section>
            <section>
                <h2>Questions?</h2>
                <footer>
                    <em><a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
                </footer>
            </section>
        </section>





    </div>

</div>

<script src="dist/reveal.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/search/search.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>

    // Also available as an ES module, see:
    // https://revealjs.com/initialization/
    Reveal.initialize({
        controls: true,
        progress: true,
        center: true,
        hash: true,
        slideNumber: true,


        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
    });

</script>
<script src="toc.js"></script>
<script src="overlay.js"></script>

</body>
</html>
