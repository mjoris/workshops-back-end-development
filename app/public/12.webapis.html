<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>W&amp;M Server-side – Course materials</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
    <link rel="stylesheet" href="main.css">
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section data-background="#b5533c">
            <h3>Web &amp; Mobile Server-side <small>[OGI03q]</small></h3>
            <h1>12. Web APIs</h1>
        </section>


        <section>

            <section>
                <h2>12.1<br>Introduction</h2>
            </section>


            <section>
                <h2>Recap: the webserver (1)</h2>
                <ul>
                    <li>
                        Webserver: a <em>program</em> processing HTTP requests and answering by HTTP responses
                    </li>
                    <li style="margin-top: 1em;">
                        PHP scripts can generate any type of HTTP response dynamically
                        <ul>
                            <li>HTTP body (content) not limited to HTML</li>
                            <li>HTTP head can be manipulated using functions like
                                <code>header()</code>
                                <small><a href="https://www.php.net/manual/en/function.header.php">⚑</a></small>
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Recap: the webserver (2)</h2>
                <ul style="width: 100%;">
                    <li>
                        Example: dynamic generation of a ZIP

                        <div>

									<pre class="bigger"><code class="hljs php" data-overlay-example="assets/12/examples/generate-zip.php">&lt;?php
$zip = new ZipArchive();
$zipFile = 'demo.zip';
if ($zip->open($zipFile, ZipArchive::CREATE) === true) {
    $iterator = new DirectoryIterator(__DIR__);
    foreach ($iterator as $file) {
        if ((!$file->isDir()) && ($file->getExtension() === 'php')) {
            $zip->addFile($file);
        }
    }
    $zip->close();

    header('Content-Type: application/zip');
    header('Content-Disposition: attachment; filename=' . $zipFile);
    header('Content-Length: ' . filesize($zipFile));
    readfile($zipFile);
}
//EOF</code></pre>

                        </div>

                    </li>
                </ul>
                <footer><small>Note: it is not a good idea to share your PHP files over the web server</small></footer>
            </section>

            <section data-background="#fdfdfd">
                <h2>Recap: client-server architecture</h2>
                <p>
                    <figure class="zoomable-20">
                        <img src="assets/12/1200px-Client-server-model.svg.png" alt="client-server model" title="client-server model" height="220"  />
                    </figure>
                </p>
                <ul style="font-size: 90%;">

                    <li>
                        Clients of a web server? Not restricted to <em>browsers</em>.
                        <ul style="font-size: 70%;">
                            <li>web bots, crawlers</li>
                            <li>Android apps</li>
                            <li>the linux command <code>curl</code></li>
                            <li>a .net Form application</li>
                            <li>JavaScript-code</li>
                            <li>&hellip;</li>
                        </ul>
                    </li>
                    <li>
                        The only restriction: they should talk over HTTP
                    </li>
                </ul>

            </section>


            <section data-background="#fdfdfd">
                <h2>Web APIs: the idea</h2>
                <p>
                    <figure class="zoomable-20">
                        <img src="assets/12/idea-restful.png" alt="Web APIs: the idea" title="Web APIs: the idea" height="250"  />
                    </figure>
                </p>
                <ul style="font-size: 80%;">
                    <li>
                        Provide a uniform (HTTP) interface to a set of services for multiple types of clients
                    </li>
                    <li>
                        Typically, it provides CRUD operations on a database
                    </li>
                    <li>
                        Why?
                        <ul>
                            <li>This an architectural pattern (a <em>good</em> practice)</li>
                            <li>Because of multiple security and technical issues, it is not common to provide access to the DBMS over the Internet, and it is often not possible to communicate directly to the DBMS from JS/mobile apps</li>
                        </ul>

                    </li>
                </ul>
            </section>
            <section data-background="#fdfdfd">
                <h2>Web APIs: why? (1)</h2>
                <ul style="font-size: 90%;">
                    <li>
                        To enable others to build cool stuff on top of your platform/data e.g.
                        <ul>
                            <li><a href="https://docs.irail.be/">iRail API</a></li>
                            <li><a href="https://developer.twitter.com/en/docs/twitter-api">Twitter API</a></li>
                        </ul>
                    </li>
                </ul>
                <figure>
                    <img src="assets/12/BotanicallsSparkfunKit_jade1_800.jpg" alt="" title="" height="350" />
                    <figcaption>Let your plants tell you <a href="https://developer.twitter.com/en/docs/twitter-api">via Twitter</a> that they're thirsty with <a href="http://www.botanicalls.com/kits/">botanicalls</a></figcaption>
                </figure>
            </section>

            <section data-background="#fdfdfd">
                <h2>Web APIs: why? (2)</h2>
                <ul style="font-size: 90%;">
                    <li>
                        Necessary when you build a <a href="https://en.wikipedia.org/wiki/Single-page_application">single-page application (SPA)</a>
                        <ul>
                            <li>Initial load: all necessary HTML/JS/CSS is retrieved from the server</li>
                            <li>Next, any required resource is dynamically loaded from JavaScript (making Web API calls) without ever reloading the page</li>
                            <li style="margin-top: 0.5em;">This <em>architectural shift</em> involves client-side
                                <a href="https://dzone.com/articles/client-side-vs-server-side-rendering-what-to-choos">rendering</a> and
                                <a href="https://stackoverflow.com/questions/10190215/what-is-client-side-routing-and-how-is-it-used">routing</a></li>
                            <li>Remember: data validation (form checking) and authentication is required on the server</li>
                        </ul>

                    </li>
                </ul>
                <figure>
                    <img src="assets/12/1576578983620.png" alt="" title="" height="250" />
                </figure>
                <footer><small>Source: DZone, <a href="https://dzone.com/articles/client-side-vs-server-side-rendering-what-to-choos">Client-Side v/s Server-Side Rendering</a></small></footer>
            </section>

            <section>
                <h2>Recap: HTTP Communication</h2>
                <ul>
                    <li>
                        In an HTML-context
                        <ul>
                            <li>
                                an HTTP request is initiated by the user, and sent by the browser (e.g. when clicking an HTML-element)
                            </li>
                            <li>
                                an HTTP response is handled by the browser <strong>synchronously</strong>
                            </li>
                            <li>
                                only the verbs GET and POST are allowed (see <a href="https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#attr-fs-method">HTML standard</a>)
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        In a context where a Web API is consumed from JavaScript
                        <ul>
                            <li>the HTTP request launch is executed from JS code</li>

                            <li>an HTTP response is handled by JS code, preferably <strong>asynchronously</strong></li>
                            <li>
                                the verbs GET, PUT, POST, PATCH, DELETE are used
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>
        </section>




        <!-- 2 : RESTful Web APIs -->
        <section>

            <section>
                <h2>12.2<br>RESTful Web APIs</h2>
            </section>


            <section>
                <h2>What's a Web API?</h2>
                <ul>
                    <li>
                        API: Application Programming Interface
                        <ul>
                            <li>Abstract Interface to allow communication between software components</li>
                            <li>eg. Photoshop has a JS based API to remotely control Photoshop</li>
                            <li>eg. Browsers have an API that allow creation of extensions</li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.7em">
                        Web API: an API offered on the web
                        <ul>
                            <li>Allow you to push/pull data to/from a web site</li>
                            <li>Scripting language independent (PHP, ASP, RoR, ..)</li>
                            <li>Sometimes referred to as a &ldquo;Web Service&rdquo; <em>(blame Microsoft)</em></li>
                            <li>Implemented via JavaScript, XML-RPC, SOAP, REST, &hellip;</li>
                            <li>Return formats JS, XML, HTML, plaintext, JSON(P), &hellip;</li>
                        </ul>
                    </li>
                </ul>
            </section>


            <section>
                <h2>What's REST?</h2>
                <ul>
                    <li>
                        REST = REpresentational State Transfer
                        <ul>
                            <li>
                                Architectural style for distributed hypermedia systems <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm">described</a> by Roy Fielding, in 2000
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        <a href="https://sookocheff.com/post/api/how-rest-constraints-affect-api-design/">REST constraints</a> <small style="background-color: #f00;border-radius: 10px;">FYI</small>
                        <ol>
                            <li>Client-server</li>
                            <li>Stateless Server</li>
                            <li>Cacheable</li>
                            <li>
                                Uniform interface
                                <ol>
                                    <li>Identification of resources <em>(URI)</em></li>
                                    <li>Manipulation of resources through representations <em>(modify/delete)</em></li>
                                    <li>Self-descriptive messages <em>(message and meta-data)</em></li>
                                    <li>Hypermedia As The Engine Of Application State <em>(state transitions)</em></li>
                                </ol>
                            </li>
                            <li>Layered System</li>
                            <li>Code-On-Demand <em>(optional)</em></li>
                        </ol>
                    </li>
                </ul>
            </section>

            <section>
                <h2>RESTful Web API</h2>
                <ul style="margin-bottom: 2em;">
                    <li>
                        Web API that follows the REST constraints
                    </li>
                    <li>
                        Constraint #4 (Uniform interface) is the tricky one
                    </li>
                </ul>
                <footer><small>Note: in this course, we will build Web APIs that are not <strong>fully</strong> REST-compliant, it is rather an ideal we are working towards</small></footer>
            </section>

            <section>
                <h2>Why choose REST?</h2>
                <ul>
                    <li>As a consumer, it's easy to work with</li>
                    <li>As a developer, it's (fairly) easy to implement</li>
                    <li>It's well structured</li>
                    <li>
                        It's popular
                    </li>
                </ul>
            </section>

        </section>


        <!-- 3: -->
        <section>
            <section>
                <h2>12.3<br>How to build a Web API</h2>
            </section>

            <!--section data-background="#fdfdfd">
                <h2 style="font-size: 70px;">Sidenote: Richardson Maturity Model <small style="background-color: #f00;border-radius: 10px;">FYI</small></h2>
                <ul>
                    <li>
                        Model that breaks down the principal elements of a REST approach in a few steps
                    </li>
                </ul>
                <figure>
                    <img src="assets/12/The-Richardson-Maturity-Model-Nordic-APIs.png" alt="" title="" height="310" />
                </figure>
                <footer><small>We don't have the time and knowledge yet to build Web APIs that are fully REST compliant <br>We'll come back on this model in some other course &hellip;</small></footer>
            </section-->

            <section>
                <h2>#1 We'll use JSON over HTTP</h2>

                <ul>
                    <li>
                        Use HTTP as a transport mechanism
                        <ul>
                            <li>
                                The consumer of the Web API sends a request to a URI using a HTTP METHOD (e.g. <code>POST</code>)
                            </li>
                            <li>
                                Based on the URI &amp; the data in the querystring, the consumer receives some data
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        This data is formatted in JSON
                        <ul>
                            <li>
                                JSON is concise and quite readable too
                            </li>

                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>API Call Example</h2>
                <ul>
                    <li>
                        Do a <code>GET</code> request to <code>/api/lecturers</code> to get back a list of lecturers as the actual content
                        <pre class="bigger"><code class="hljs javascript" style="max-height: 380px; overflow: scroll;">{
	&quot;lecturers&quot;:
	[
		{
			&quot;id&quot;: 1,
			&quot;name&quot;: &quot;Joris Maervoet&quot;
		},
		{
			&quot;id&quot;: 2,
			&quot;name&quot;: &quot;Pieter Van Peteghem&quot;
		}
	]
}</code></pre>
                    </li>
                </ul>
            </section>

            <section style="font-size: 90%;"  data-background="#fdfdfd">
                <h2>#2 A uniform interface (1)</h2>
                <ul>
                    <li><strong>Resource:</strong> information of a certain type that can be accessed through the web API (e.g. products, lecturers, &hellip;)
                        <ul>
                            <li>
                                Resources are identified by a URI
                            </li>
                            <li>
                                Subordinate resources are ordered in a <strong>hierarchy</strong>
                            </li>
                        </ul>

                    </li>
                    <li style="margin-top: 0.5em;">
                        Naming conventions
                        <ul>
                            <li>Nouns are preferred over verbs</li>
                            <li>Use plurals</li>
                            <li>Use concrete, appropriate names that describe the resource</li>
                            <li><strong>be consistent</strong></li>
                        </ul>

                    </li>
                    <li style="margin-top: 0.5em;">
                        Examples of <strong>endpoints</strong>
                        <ul>
                            <li><del><code>/product</code></del> &rarr; <ins><code>/products</code></ins></li>
                            <li><del><code>/product/1234</code></del> &rarr; <ins><code>/products/1234</code></ins></li>
                            <li><del><code>/photos/product/1234</code></del> &rarr; <ins><code>/products/1234/photos</code></ins></li>
                            <li><del><code>/photos/product/1234/5678</code></del> &rarr; <ins><code>/products/1234/photos/5678</code></ins></li>
                        </ul>
                    </li>
                </ul>

            </section>

            <section>
                <h2>#2 A uniform interface (2)</h2>
                <ul>
                    <li>
                        Use URL parameters when necessary
                        <ul>
                            <li><strong>be consistent</strong></li>
                            <li>pass a foreign key <code>/lecturers?course=1</code></li>
                            <li>filtering and sorting <code>/lecturers?filter=foo&sort=asc</code></li>
                            <li>limiting fields <code>/lecturers?fields=name,age</code></li>
                            <li>pagination (mandatory for huge resources) <code>/lecturers?limit=10&offset=120</code></li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        Some cases will require a verb instead of a noun, yet consider these exceptions
                        <ul>
                            <li><code>/search?course=WMD</code></li>
                            <li><code>/convert?from=EUR&amp;to=USD&amp;amount=100</code></li>
                        </ul>
                    </li>
                </ul>

            </section>


            <section>
                <h2>#3 HTTP Verbs &amp; HTTP Response Codes</h2>

                <ul>
                    <li>
                        Don't limit yourself to <code>POST</code>, but use all HTTP verbs
                        <ul>
                            <li>e.g. <code>POST</code>, <code>GET</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>, &hellip;</li>
                            <li>
                                Depending on the HTTP verb used, a specific action will be taken
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        When an action has been taken, correctly use the HTTP response codes
                        <ul>
                            <li>e.g. <code>404</code>, <code>500</code>, &hellip;</li>
                        </ul>
                    </li>
                </ul>
                <footer>&rarr; In short: use HTTP to the fullest</footer>
            </section>


            <section>
                <h2>HTTP Verbs</h2>
                <ul>
                    <li>
                        HTTP Verbs = CRUD = Queries
                        <ul>
                            <li><code>POST</code> = Create resource = <code>INSERT &hellip;</code></li>
                            <li><code>GET</code> = Read resource = <code>SELECT &hellip;</code></li>
                            <li><code>PUT</code> = Update resource = <code>UPDATE &hellip;</code></li>
                            <li><code>PATCH</code> = Update resource = <code>UPDATE &hellip;</code></li>
                            <li><code>DELETE</code> = Delete resource = <code>DELETE &hellip;</code></li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.5em;">
                        Examples
                        <ul>
                            <li><code>POST /products</code> <em>(data via <code>$_POST</code>)</em></li>
                            <li><code>GET /products</code> or <code>GET /products/1234</code></li>
                            <li><code>PUT /products/1234</code> <em>(data via &ldquo;<code>$_PUT</code>&rdquo;)</em></li>
                            <li><code>DELETE /products/1234</code></li>
                        </ul>
                    </li>
                </ul>
            </section>


            <section>
                <h2>HTTP Verbs Sidenote: PATCH vs. PUT</h2>

                <ul>
                    <li>
                        What's the difference?
                        <ul>
                            <li>
                                <code>PUT</code> = replace a resource entirely
                            </li>
                            <li>
                                <code>PATCH</code> = partially replace a resource
                            </li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em">
                        But ...
                        <div>
                            <blockquote style="width: 100%">The <code>PATCH</code> method applies <strong>a delta (diff)</strong> rather than replacing the entire resource. The request entity to <code>PATCH</code> is of a different content-type that the resource that is being modified. Instead of being an entire resource representation, it is a resource that describes changes to apply on a resource.</blockquote>
                            <p style="text-align: right; font-size: 50%;"><em>Source: <a href="http://williamdurand.fr/2014/02/14/please-do-not-patch-like-an-idiot/">Please don't patch like an idiot</a></em></p>
                        </div>
                    </li>
                </ul>

            </section>

            <section>
                <h2>HTTP Status Codes (1)</h2>
                <ul>
                    <li>
                        When accessing a resource, you'll get back the data, along with <a href="http://httpstatus.es/">an HTTP status code</a>
                    </li>
                    <li style="margin-top: 1em;">
                        General Codes (applicable to all verbs/resources) <small style="background-color: #f00;border-radius: 10px;">FYI</small>
                        <ul>
                            <li><code>400 &mdash; Bad Request</code> <em>(e.g. Request Body is malformed / not parseable)</em></li>
                            <li><code>401 &mdash; Not Authorized</code> <em>(e.g. No API Key given)</em></li>
                            <li><code>405 &mdash; Method Not Allowed</code> <em>(e.g. wrong verb for resource)</em></li>
                            <li><code>415 &mdash; Unsupported Media Type</code></li>
                            <li><code>422 — Unprocessable Entity</code> (Validation Errors)</li>
                            <li><code>429 — Too Many Requests</code> (Rate Limiting)</li>
                            <li><code>500 &mdash; Internal Server Error</code> <em>(Developer screwed up ;))</em></li>
                        </ul>
                    </li>
                </ul>

            </section>

            <section>
                <h2>HTTP Status Codes (2)</h2>
                <ul>
                    <li>
                        <code>GET</code> <small style="vertical-align: baseline;">(SQL SELECT)</small>
                        <ul>
                            <li><code>200 &mdash; OK</code> <em>(requested data sent via response body)</em></li>
                            <li><code>404 &mdash; Not Found</code> <em>(resource not found, not &ldquo;API not found&rdquo;)</em></li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        <code>POST</code> <small style="vertical-align: baseline;">(SQL INSERT)</small>
                        <ul>
                            <li><code>201 &mdash; Created</code> <em>(=OK)</em></li>
                            <li><code>400 &mdash; Bad Request</code> <em>(Missing Parameters)</em></li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>HTTP Status Codes (3)</h2>
                <ul>
                    <li>
                        <code>PUT</code> <small style="vertical-align: baseline;">(SQL UPDATE)</small>
                        <ul>
                            <li><code>200 &mdash; OK</code> <em>(requested data sent via response body)</em></li>
                            <li><code>400 &mdash; Bad Request</code> <em>(Missing Parameters)</em></li>
                            <li><code>404 &mdash; Not Found</code></li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        <code>DELETE</code> <small style="vertical-align: baseline;">(SQL DELETE)</small>
                        <ul>
                            <li><code>204 &mdash; No Content</code> <em>(=OK &mdash; Note: <strong>no</strong> response body sent!)</em></li>
                            <li><code>404 &mdash; Not Found</code></li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">
                        Warning!
                        <ul><li>HTTP Statuses 4XX and 5XX will invoke <code>$.ajax().error()</code> in <a href="https://api.jquery.com/jquery.ajax/">jQuery</a>!</li>
                        <li>&hellip; but <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">will not with Fetch API</a></li></ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>API Call Example (1)</h2>
                <ul>
                    <li>
                        Do a <code>GET</code> request to <code>/api/lecturers</code> and get back an HTTP <code>200</code> status code and a list of lecturers as the content
                        <pre class="bigger"><code class="hljs javascript" style="max-height: 380px; overflow: scroll;">{
	&quot;lecturers&quot;:
	[
		{
			&quot;id&quot;: 1,
			&quot;name&quot;: &quot;Joris Maervoet&quot;
		},
		{
			&quot;id&quot;: 2,
			&quot;name&quot;: &quot;Pieter Van Peteghem&quot;
		}
	]
}</code></pre>
                    </li>
                </ul>
            </section>

            <section>
                <h2>API Call Example (2)</h2>
                <ul>
                    <li>
                        Do a <code>POST</code> request to <code>/api/lecturers</code> with some data in <code>$_POST</code> to insert a new lecturer
                        <ul>
                            <li>Get back <code>201 &mdash; Created</code> if all OK</li>
                            <li>Get back <code>400 &mdash; Bad Request</code> if parameters are missing</li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.8em;">
                        Do a <code>PUT</code> request to <code>/api/lecturers/2</code> with some data in <code>$_PUT</code> to update a lecturer
                        <ul>
                            <li>Get back <code>200 &mdash; OK</code> if all OK</li>
                            <li>Get back <code>400 &mdash; Bad Request</code> if parameters are missing</li>
                            <li>Get back <code>404 &mdash; Not Found</code> if the lecturer does not exist</li>
                        </ul>
                    </li>
                </ul>
            </section>




            <section>
                <h2>#4 Media Types</h2>

                <ul>
                    <li>

                        An API can support multiple hypermedia types
                        <ul>
                            <li>
                                The client indicates in an <code>Accept</code> header
                                <ul>
                                    <li>e.g <code>Accept: application/collection+json</code> <a href="https://github.com/collection-json/spec">(link)</a></li>
                                    <li>Content negotiation e.g. <code>Accept: application/xml; q=0.8, application/json</code></li>
                                </ul>
                            </li>

                            <li>
                                &rarr; We'll just stick to JSON
                            </li>
                            <li>
                                The server indicates the type in a <code>Content-Type</code> header
                                <ul>
                                    <li>e.g <code>Content-Type: application/json; charset=UTF-8</code></li>
                                </ul>
                            </li>

                        </ul>
                    </li>
                </ul>
            </section>

        </section>





        <!-- 3 : Web API example in PHP -->
        <section>

            <section>
                <h2>12.4<br>Web API example in PHP</h2>
            </section>

            <section>
                <h2>Let's define a reusable controller</h2>
                <ul style="width: 100%;font-size: 85%;">
                    <li>Let's call this class <code>ApiBaseController</code></li>
                </ul>
                <pre class="bigger"><code class="hljs php" style="max-height: 430px; line-height: 1;">&lt;?php
abstract class ApiBaseController
{
    protected ?array $httpBody;

    public function __construct()
    {
        // Parse the HTTP request body assuming it contains plain JSON
        $this-&gt;httpBody = json_decode(file_get_contents('php://input'), true);

        // set the Content-type header of the HTTP response to JSON
        header('Content-type: application/json; charset=UTF-8');
    }

    protected function message(int $httpCode, string $message) {
        http_response_code($httpCode);
        $answer = ['message' =&gt; $message];
        echo json_encode($answer);
    }
}</code></pre>
                <ul style="width: 100%;font-size: 85%;">
                    <li>
                        Idea: create your own <em>resource controller</em> (e.g. <code>LecturerController</code>) by extending <code>ApiBaseController</code>
                        <ul style="font-size: 85%;">
                            <li>When <code>bramus/router</code> is pointed towards a handling function such as <code>LecturerController@get</code>, it will need to <strong>construct</strong> the object first.</li>
                            <li>When <code>LecturerController</code> has no constructor, the parent constructor will be called, decoding eventual data in the HTTP request's body and setting the HTTP response's Content-type header to JSON</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>A simple example (1)</h2>
                <pre class="bigger"><code class="hljs php" style="max-height: 430px;">&lt;?php

require __DIR__ . '/vendor/autoload.php';

$router = new \Bramus\Router\Router();

$router-&gt;mount('/api', function() use ($router) {
    $router-&gt;get('/lecturers', 'LecturerController@overview');
    $router-&gt;post('/lecturers', 'LecturerController@methodNotAllowed');
    $router-&gt;get('/lecturers/(\d+)', 'LecturerController@get');

});

$router-&gt;run();</code></pre>
            </section>
            <section>
                <h2>A simple example (2)</h2>
                <pre class="bigger"><code class="hljs php" style="max-height: 430px;">&lt;?php

class LecturerController extends ApiBaseController
{
    private $lecturers = [
        1 =&gt; ['id' =&gt; 1, 'name' =&gt; 'Joris Maervoet'],
        2 =&gt; ['id' =&gt; 2, 'name' =&gt; 'Pieter Van Peteghem']];

    public function overview() {
        echo json_encode(['lecturers' =&gt; array_values($this-&gt;lecturers)]);
    }

    public function get($id) {
        if (array_key_exists($id, $this-&gt;lecturers)) {
            echo json_encode($this-&gt;lecturers[$id]);
        } else {
            $this-&gt;message(404, 'Lecturer not found.' ); // 404 Not Found.
        }
    }

}
</code></pre>
            </section>
            <section>
                <h2>API testing tools</h2>

                <ul>
                    <li style="margin-top: 1em;">
                        Recommended tools: <a href="https://www.getpostman.com">Postman</a>, <a href="https://insomnia.rest/">Insomnia</a> REST client.



                    </li>
                    <li style="margin-top: 1em;">&rarr; Let's test our <code>api/lecturers</code> endpoint with Insomnia</li>
                </ul>
                <figure><img src="assets/12/insomnia-promo.png" alt="Insomnia screenshot" width="400"></figure>
                <footer><small>Full path: <code>http://localhost:8080/assets/12/examples/project-with-webapi/api/lecturers</code></small></footer>
            </section>

            <section>
                <h2>A more advanced example</h2>

                <ul>
                    <li>
                        Typically, a web API provides CRUD operations on a database


                    </li>
                    <li>
                        Typically, all data in the HTTP request is controlled/validated
                        thoroughly.


                    </li>
                    <li style="margin-top: 1em;">Reimport the database dump (DB <code>demo-webapi</code>)</li>
                    <li>&rarr; Let's have a look at <code>ProductController</code></li>
                </ul>

            </section>

        </section>

        <!-- 5 : Consuming a Web API in JavaScript -->
        <section>
            <section>
                <h2>12.5<br>Consuming a Web API in JavaScript</h2>
            </section>

            <section>
                <h2>Consuming RESTful APIs</h2>
                <ul style="width: 100%;">
                    <li>
                        How to? See <em>Web &amp; Mobile 2 / Front-End</em>
                    </li>
                    <li>
                        Have a look at <code>demo.twig</code>

                    </li>
                </ul>
                <pre class="bigger"><code class="hljs javascript" data-overlay-example="assets/12/examples/project-with-webapi/">        // wait till DOM is loaded
        window.addEventListener('load', function() {
            let url = 'api/products';

            // POST example: fetch(url, {method: 'post', body: JSON.stringify(opts)})
            // response.ok is true when the status code is 2xx
            fetch(url)
                .then(response =&gt; response.ok ? response.json() : Promise.reject({err: response.status}))
                .then(data =&gt; fillProducts(data))
                .catch(error =&gt; window.alert('Request Failed: ' + error.err));

            let fillProducts = function (data) {
                data.products.forEach(function (product, index)
                    document.body.innerHTML += '&lt;div class="card"&gt;&lt;div class="container"&gt;&lt;h4&gt;' + product.title + '&lt;/h4&gt;&lt;p&gt;Price: ' + product.price + '&euro;&lt;/p&gt;&lt;p&gt;Stock quantity: ' + product.quantity + '&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';
                });
            };</code></pre>
            </section>

            <section>
                <h2>Same-origin policy</h2>
                <ul>
                    <li>Same-origin policy: a script loaded from one origin can only access resources from the same origin
                        <ul>
                            <li>Origin = protocol + host + port</li>
                            <li>Example: a script loaded from <code>https://www.ikdoeict.be</code>
                                <ul>
                                    <li>cannot access the elements of an <code>&lt;iframe&gt;</code> from <code>https://kbctouch.kbc.be</code></li>
                                    <li>can only consume a web API from that origin</li>
                                </ul>
                            </li>

                            <li>In most browsers even <code>localhost</code> and <code>127.0.0.1</code> do conflict</li>
                            <li>Reason: security</li>
                        </ul>
                    </li>
                    <li style="margin-top: 0.5em;">
                        Multiple techniques to relax this policy
                        <ul>
                            <li><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin resource sharing (CORS)</a>: HTTP headers indicating whether an origin can be trusted</li>
                        </ul>
                    </li>
                </ul>
            </section>

        </section>

        <section>
            <section>
                <h2>12.6<br>What's next?</h2>
            </section>
            <section>
                <h2>Not talked about &hellip;</h2>
                <ul>
                    <li>API keys ~ identification of the project using the API</li>
                    <li style="margin-top: 1em;">Authentication (of end users)
                        <ul>
                            <li>Token-based = stateless authentication (e.g. <a href="https://en.wikipedia.org/wiki/JSON_Web_Token">JSON Web Tokens</a>)</li>
                            <li><a href="https://oauth.net/2/">OAuth 2.0</a> is a standard protocol using JWT (<a
                                    href="https://oauth2.thephpleague.com/"><code>league/oauth2-server</code></a>)</li>
                        </ul>
                    </li>
                    <li style="margin-top: 1em;">Rate limiting / throttling (see <a href="https://packagist.org/?query=rate%20limiter">Packagist</a>)</li>
                    <li style="margin-top: 1em;">Automated Web API documentation (<a href="https://medium.com/@nyllor/generate-openapi-documentation-for-your-php-api-45f526f3975c">example</a>)</li>
                </ul>
            </section>
        </section>

        <!-- The END -->
        <section>
            <section>
                <h2>Questions?</h2>
                <footer>
                    <em><a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
                </footer>
            </section>

            <section>
                <h2>Sources</h2>
                <ul style="font-size: 80%;">
                    <!-- REST Intro -->
                    <li><a href="http://en.wikipedia.org/wiki/Representational_state_transfer">http://en.wikipedia.org/wiki/Representational_state_transfer</a></li>
                    <li><a href="http://www.slideshare.net/jmusser/pw-glue-conmay2010">http://www.slideshare.net/jmusser/pw-glue-conmay2010</a></li>
                    <li><a href="http://www.slideshare.net/al3x/the-interaction-design-of-apis">http://www.slideshare.net/al3x/the-interaction-design-of-apis</a></li>

                    <!-- REST URL Design -->

                    <li><a href="http://www.slideshare.net/apigee/restful-api-design-second-edition">http://www.slideshare.net/apigee/restful-api-design-second-edition</a></li>

                    <li><a href="http://httpstatus.es/">http://httpstatus.es/</a></li>
                    <li><a href="http://restcookbook.com/">http://restcookbook.com/</a></li>
                    <li><a href="http://barelyenough.org/blog/2008/05/versioning-rest-web-services/">http://barelyenough.org/blog/2008/05/versioning-rest-web-services/</a></li>

                    <!-- HATEOAS -->
                    <li><a href="http://en.wikipedia.org/wiki/HATEOAS">http://en.wikipedia.org/wiki/HATEOAS</a></li>
                    <li><a href="http://martinfowler.com/articles/richardsonMaturityModel.html">http://martinfowler.com/articles/richardsonMaturityModel.html</a></li>
                    <li><a href="http://www.smartjava.org/content/presentation-rest-hateoas">http://www.smartjava.org/content/presentation-rest-hateoas</a></li>
                    <li><a href="http://www.infoq.com/articles/mark-baker-hypermedia">http://www.infoq.com/articles/mark-baker-hypermedia</a></li>

                    <!-- Authentication -->
                    <li><a href="http://en.wikipedia.org/wiki/Oauth">http://en.wikipedia.org/wiki/Oauth</a></li>
                    <li><a href="http://www.slideshare.net/leahculver/oauth-open-api-authentication">http://www.slideshare.net/leahculver/oauth-open-api-authentication</a></li>

                    <!-- Update -->
                    <li><a href="https://www.codeofaninja.com/2017/02/create-simple-rest-api-in-php.html">https://www.codeofaninja.com/2017/02/create-simple-rest-api-in-php.html</a></li>
                    <li><a href="https://davisonpro.dev/how-to-create-an-advanced-php-rest-api/">https://davisonpro.dev/how-to-create-an-advanced-php-rest-api/</a></li>
                    <li><a href="https://apisyouwonthate.com/blog/rest-and-hypermedia-in-2019">https://apisyouwonthate.com/blog/rest-and-hypermedia-in-2019</a></li>
                </ul>
            </section>
        </section>





    </div>

</div>

<script src="dist/reveal.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/search/search.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>

    // Also available as an ES module, see:
    // https://revealjs.com/initialization/
    Reveal.initialize({
        controls: true,
        progress: true,
        center: true,
        hash: true,
        slideNumber: true,


        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
    });

</script>
<script src="toc.js"></script>
<script src="overlay.js"></script>

</body>
</html>